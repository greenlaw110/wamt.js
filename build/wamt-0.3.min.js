var wamt={time:new Date(),delta:0,fps:0};wamt.behaviours={};wamt.support={canvas:typeof(window.CanvasRenderingContext2D)!="undefined",light:typeof(window.CanvasRenderingContext2D.prototype.createRadialGradient)!="undefined"&&typeof(window.CanvasRenderingContext2D.prototype.setShadow)!="undefined"};wamt.settings={culling:true,smoothing:true};Math["radians"]=function(degrees)
{return degrees*Math.PI/180;};window.requestAnimationFrame=(function()
{return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element)
{window.setTimeout(callback,1000/60);};})();wamt.render=function(scene,view)
{var now=new Date();wamt.delta=now-wamt.time;wamt.fps=Math.round(1000/wamt.delta);wamt.time=now;if(scene.updated||view.updated)
{view.clearCanvas();view.renderBackdrop();if(typeof(view.target)!="undefined")
{view.x=view.target.x;view.y=view.target.y;view.angle=view.target.angle;view.radians=view.target.radians;}
var ix=view.canvas.width;var iy=view.canvas.height;for(var j=0;j<scene.layers.length;j++)
{var layer=scene.layers[j];view.context.globalCompositeOperation=layer.composite;view.context.globalAlpha=layer.opacity;for(var i=0;i<layer.objects.length;i++)
{var object=layer.objects[i];object.tick(scene,layer,view);if(typeof(object.render)=="undefined")
continue;var ox=object.screenX+object.bounds[0];var oy=object.screenY+object.bounds[1];var cx=ix+(object.bounds[0]*2);var cy=iy+(object.bounds[1]*2);if((ox>=-cx&&ox<=cx)&&(oy>=-cy&&oy<=cy)||!wamt.settings.culling)
object.render(view);}}
scene.updated=false;view.updated=false;}
else
{for(var j=0;j<scene.layers.length;j++)
{var layer=scene.layers[j];for(var i=0;i<layer.objects.length;i++)
{var object=layer.objects[i];object.tick(scene,layer,view);}}}};wamt.Layer=function(scene,index)
{this.scene=scene;this.index=index;this.objects=[];this.opacity=1;this.composite="source-over";this.locked=false;};wamt.Layer.prototype.constructor=wamt.Layer;wamt.Layer.prototype.addObject=function(object)
{object.scene=this.scene;object.layer=this;this.objects.push(object);};wamt.Layer.prototype.setOpacity=function(opacity)
{this.opacity=opacity;this.scene.updated=true;};wamt.Layer.prototype.setCompositeOperation=function(type)
{this.composite=type;this.scene.updated=true;};wamt.Layer.prototype.setLocked=function(locked)
{this.locked=locked;this.scene.updated=true;};wamt.Scene=function()
{this.updated=false;this.layers=[];};wamt.Scene.prototype.constructor=wamt.Scene;wamt.Scene.prototype.getLayer=function(index)
{var l;for(var i=0;i<this.layers.length;i++)
{var layer=this.layers[i];if(layer.index==index)
{l=layer;break;}}
return l;};wamt.Scene.prototype.createLayer=function(index)
{var layer=new wamt.Layer(this,index);this.layers.push(layer);this.layers.sort(function(a,b)
{if(a.index<b.index)
return-1;if(a.index>b.index)
return 1;else
return 0;});return layer;};wamt.Scene.prototype.addObject=function(object,layer)
{layer=typeof(layer)=="number"?layer:0;tlayer=this.getLayer(layer);if(typeof(tlayer)=="undefined")
var tlayer=this.createLayer(layer);tlayer.addObject(object);if(typeof(object.render)!="undefined")
this.updated=true;};wamt.Scene.prototype.clearLayers=function()
{this.layers=[];};wamt.View=function(canvas,x,y)
{this.canvas=canvas;this.context=canvas.getContext("2d");this.x=typeof(x)=="undefined"?canvas.width/2:x;this.y=typeof(y)=="undefined"?canvas.height/2:y;};wamt.View.prototype.constructor=wamt.View;wamt.View.prototype.addEventListener=function(type,bind)
{switch(type)
{case"mousemove":this.canvas.addEventListener("mousemove",function(event)
{event.view=this;event.context=this.view;bind(event);});break;case"mousedown":this.canvas.addEventListener("mousedown",function(event)
{event.view=this;event.context=this.view;bind(event);});break;case"mouseup":this.canvas.addEventListener("mouseup",function(event)
{event.view=this;event.context=this.view;bind(event);});break;case"click":this.canvas.addEventListener("click",function(event)
{event.view=this;event.context=this.view;bind(event);});break;}};wamt.View.prototype.setBackdrop=function(value)
{this.backdrop=value;};wamt.View.prototype.renderBackdrop=function()
{if(typeof(this.backdrop)=="undefined")
return;if(this.backdrop instanceof Image)
this.context.drawImage(this.backdrop,0,0,this.canvas.width,this.canvas.height);else
{this.context.fillStyle=this.backdrop;this.context.fillRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle="";}};wamt.View.prototype.setCanvas=function(canvas)
{this.canvas=canvas;this.context=canvas.getContext("2d");};wamt.View.prototype.clearCanvas=function()
{this.context.clearRect(0,0,this.canvas.width,this.canvas.height);};wamt.View.prototype.setTarget=function(target)
{this.target=target;};wamt.View.prototype.setX=function(x)
{this.x=x;this.updated=true;};wamt.View.prototype.setY=function(y)
{this.y=y;this.updated=true;};wamt.View.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.updated=true;};wamt.View.prototype.translateX=function(x)
{this.x+=x;this.updated=true;};wamt.View.prototype.translateY=function(y)
{this.y+=y;this.updated=true;};wamt.View.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.updated=true;};wamt.Box=function(style,width,height,x,y,angle)
{this.events=[];this.collideable=true;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof(angle)=="undefined"?0:angle;this.radians=typeof(angle)=="undefined"?0:Math.radians(angle);this.width=width;this.height=height;this.style=style;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.hollow=false;this.computeBounds();};wamt.Box.prototype.constructor=wamt.Box;wamt.Box.prototype.computeBounds=function()
{if(this.angle==0||this.angle==180)
this.bounds=[this.width,this.height];else if(this.angle==90||this.angle==270)
this.bounds=[this.height,this.width];else
this.bounds=[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)];};wamt.Box.prototype.setColliding=function(colliding)
{this.collideable=colliding;};wamt.Box.prototype.setHollow=function(hollow)
{this.hollow=hollow;this.scene.updated=true;};wamt.Box.prototype.tick=function(scene,layer,view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.pretick(this);if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}}
if(typeof(this.behaviour)!="undefined")
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Box.prototype.render=function(view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.prerender(this);var radians=this.radians;view.context.strokeStyle=this.style;view.context.fillStyle=this.style;view.context.shadowOffsetX=this.shadow[0];view.context.shadowOffsetY=this.shadow[1];view.context.shadowBlur=this.shadow[2];view.context.shadowColor=this.shadow[3];if(radians==0)
{if(this.hollow)
view.context.strokeRect(this.screenX,this.screenY,this.width,this.height);else
view.context.fillRect(this.screenX,this.screenY,this.width,this.height);}
else
{var transx=(this.width/2)+this.screenX;var transy=(this.height/2)+this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);if(this.hollow)
view.context.strokeRect(this.screenX,this.screenY,this.width,this.height);else
view.context.fillRect(this.screenX,this.screenY,this.width,this.height);view.context.restore();}
view.context.strokeStyle="";view.context.fillStyle="";view.context.shadowOffsetX="";view.context.shadowOffsetY="";view.context.shadowBlur="";view.context.shadowColor="";if(typeof(this.behaviour)!="undefined")
this.behaviour.render(this);this.processEvent("render",{object:this,view:view});};wamt.Box.prototype.setStyle=function(style)
{this.style=style;this.scene.updated=true;};wamt.Box.prototype.setShadow=function(offsetx,offsety,blur,color)
{this.shadow=[offsetx,offsety,blur,color];this.scene.updated=true;};wamt.Box.prototype.setShadowCasting=function(shadowcast)
{this.shadowcast=shadowcast;this.scene.updated=true;};wamt.Box.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Box.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Box.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Box.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Box.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Box.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Box.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Box.prototype.stop=function()
{this.velocity=[0,0];this.scene.updated=true;};wamt.Box.prototype.setWidth=function(width)
{this.width=width;this.computeBounds();this.scene.updated=true;};wamt.Box.prototype.setHeight=function(height)
{this.height=height;this.computeBounds();this.scene.updated=true;};wamt.Box.prototype.setSize=function(width,height)
{this.width=width;this.height=height;this.computeBounds();this.scene.updated=true;};wamt.Box.prototype.stretchX=function(width)
{this.width+=width;if(this.width<1)
this.width=1;this.computeBounds();this.scene.updated=true;}
wamt.Box.prototype.stretchY=function(height)
{this.height+=height;if(this.height<1)
this.height=1;this.computeBounds();this.scene.updated=true;}
wamt.Box.prototype.stretch=function(width,height)
{this.width+=width;if(this.width<1)
this.width=1;this.height+=height;if(this.height<1)
this.height=1;this.computeBounds();this.scene.updated=true;}
wamt.Box.prototype.setAngle=function(angle)
{this.angle=angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Box.prototype.rotate=function(angle)
{this.angle+=angle;if(this.angle>360)
this.angle=this.angle-360;else if(this.angle<0)
this.angle=360-this.angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Box.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Box.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Box.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};wamt.Circle=function(style,radius,x,y,angle)
{this.events=[];this.collideable=true;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof(angle)=="undefined"?0:angle;this.radians=typeof(angle)=="undefined"?0:Math.radians(angle);this.radius=radius;this.style=style;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.shadowcast=false;this.hollow=false;this.computeBounds();};wamt.Circle.prototype.constructor=wamt.Circle;wamt.Circle.prototype.computeBounds=function()
{this.bounds=[this.radius*2,this.radius*2];};wamt.Circle.prototype.setColliding=function(colliding)
{this.collideable=colliding;};wamt.Circle.prototype.setHollow=function(hollow)
{this.hollow=hollow;this.scene.updated=true;};wamt.Circle.prototype.tick=function(scene,layer,view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.pretick(this);if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}}
if(typeof(this.behaviour)!="undefined")
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Circle.prototype.render=function(view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.prerender(this);var radians=this.radians;view.context.fillStyle=this.style;view.context.strokeStyle=this.style;view.context.shadowOffsetX=this.shadow[0];view.context.shadowOffsetY=this.shadow[1];view.context.shadowBlur=this.shadow[2];view.context.shadowColor=this.shadow[3];if(radians==0)
{view.context.beginPath();view.context.arc(this.screenX,this.screenY,this.radius,0,Math.PI*2,false);if(this.hollow)
view.context.stroke();else
view.context.fill();}
else
{var transx=this.screenX;var transy=this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);view.context.beginPath();view.context.arc(this.screenX,this.screenY,this.radius,0,Math.PI*2,false);if(this.hollow)
view.context.stroke();else
view.context.fill();view.context.restore();}
view.context.shadowOffsetX="";view.context.shadowOffsetY="";view.context.shadowBlur="";view.context.shadowColor="";view.context.fillStyle="";view.context.strokeStyle="";if(typeof(this.behaviour)!="undefined")
this.behaviour.render(this);this.processEvent("render",{object:this,view:view});};wamt.Circle.prototype.setStyle=function(style)
{this.style=style;this.scene.updated=true;};wamt.Circle.prototype.setShadow=function(offsetx,offsety,blur,color)
{this.shadow=[offsetx,offsety,blur,color];this.scene.updated=true;};wamt.Circle.prototype.setShadowCasting=function(shadowcast)
{this.shadowcast=shadowcast;this.scene.updated=true;};wamt.Circle.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Circle.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Circle.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Circle.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Circle.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Circle.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Circle.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Circle.prototype.setRadius=function(radius)
{this.radius=radius;this.computeBounds();this.scene.updated=true;};wamt.Circle.prototype.stretch=function(radius)
{this.radius+=radius;if(this.radius<1)
this.radius=1;this.computeBounds();this.scene.updated=true;}
wamt.Circle.prototype.setAngle=function(angle)
{this.angle=angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Circle.prototype.rotate=function(angle)
{this.angle+=angle;if(this.angle>360)
this.angle=this.angle-360;else if(this.angle<0)
this.angle=360-this.angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Circle.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Circle.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Circle.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};wamt.collision={};wamt.collision.screenPointTest=function(target,x,y)
{var collisions=[];if(target instanceof wamt.Layer)
{for(var i=0;i<target.objects.length;i++)
{var object=target.objects[i];if(!object.collideable)
continue;if((x>=object.screenX-(object.bounds[0])&&x<=object.screenX+(object.bounds[0]))&&(y>=object.screenY-(object.bounds[1])&&y<=object.screenY+(object.bounds[1])))
collisions.push(object);}}
else
{for(var l=0;l<target.layers.length;l++)
{var layer=target.layers[l];for(var i=0;i<layer.objects.length;i++)
{var object=layer.objects[i];if(!object.collideable)
continue;if((x>=object.screenX-(object.bounds[0])&&x<=object.screenX+(object.bounds[0]))&&(y>=object.screenY-(object.bounds[1])&&y<=object.screenY+(object.bounds[1])))
collisions.push(object);}}}
return collisions;};wamt.collision.layerObjectTest=function(a)
{var collisions=[];for(var i=0;i<a.layer.objects.length;i++)
{var b=a.layer.objects[i];if(!b.collideable||b==a)
continue;if(!(b.x>a.x+a.bounds[0]||b.x+b.bounds[0]<a.x||b.y>a.y+a.bounds[1]||b.y+b.bounds[1]<a.y))
collisions.push(b);}
return collisions;};wamt.collision.sceneObjectTest=function(a)
{var collisions=[];for(var l=0;l<a.scene.layers.length;l++)
{var layer=a.scene.layers[l];for(var i=0;i<layer.objects.length;i++)
{var b=layer.objects[i];if(!b.collideable||b==a)
continue;if(!(b.x>a.x+a.bounds[0]||b.x+b.bounds[0]<a.x||b.y>a.y+a.bounds[1]||b.y+b.bounds[1]<a.y))
collisions.push(b);}}
return collisions;};wamt.Light=function(color,intensity,x,y)
{this.events=[];this.collideable=false;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.intensity=intensity;this.color=color;this.computeBounds();};wamt.Light.prototype.constructor=wamt.Light;wamt.Light.prototype.computeBounds=function()
{this.bounds=[this.intensity*2,this.intensity*2];};wamt.Light.prototype.tick=function(scene,layer,view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.pretick(this);if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}
for(var i=0;i<layer.objects.length;i++)
{var object=layer.objects[i];if(!object.shadowcast)
continue;var distx=object.x-this.x;var disty=object.y-this.y;if(Math.abs(distx)>this.intensity*1.5||Math.abs(disty)>this.intensity*1.5)
{object.setShadow(0,0,0,"rgba(0,0,0,0");continue;}
var mult=0.3/this.intensity;var offx=distx*mult*object.bounds[0];var offy=disty*mult*object.bounds[1];object.setShadow(offx,offy,this.intensity*mult,"rgba(0,0,0,0.35)");}}
if(typeof(this.behaviour)!="undefined")
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Light.prototype.render=function(view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.prerender(this);var gradient=view.context.createRadialGradient(this.screenX,this.screenY,0,this.screenX,this.screenY,this.intensity);gradient.addColorStop(0,this.color);gradient.addColorStop(1,"rgba(0,0,0,0)");view.context.fillStyle=gradient;view.context.beginPath();view.context.arc(this.screenX,this.screenY,this.intensity,0,Math.PI*2,false);view.context.fill();view.context.fillStyle="";if(typeof(this.behaviour)!="undefined")
this.behaviour.render(this);this.processEvent("render",{object:this,view:view});};wamt.Light.prototype.setColor=function(red,green,blue,alpha)
{this.color=[red,green,blue,alpha];this.scene.updated=true;};wamt.Light.prototype.setIntensity=function(intensity)
{this.intensity=intensity;this.computeBounds();this.scene.updated=true;};wamt.Light.prototype.intensify=function(intensity)
{this.intensity+=intensity;if(this.intensity<1)
this.intensity=1;this.computeBounds();this.scene.updated=true;};wamt.Light.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Light.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Light.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Light.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Light.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Light.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Light.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Light.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Light.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Light.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};wamt.Polygon=function(style,vertices,x,y,angle)
{this.events=[];this.collideable=true;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof(angle)=="undefined"?0:angle;this.radians=typeof(angle)=="undefined"?0:Math.radians(angle);this.vertices=vertices;this.style=style;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.shadowcast=false;this.computeBounds();};wamt.Polygon.prototype.constructor=wamt.Polygon;wamt.Polygon.prototype.computeBounds=function()
{var minx=0;var miny=0;var maxx=0;var maxy=0;for(var i=0;i<this.vertices.length;i++)
{var vertice=this.vertices[i];var tminx=Math.min(minx,vertice[0]);var tminy=Math.min(miny,vertice[0]);var tmaxx=Math.max(maxx,vertice[1]);var tmaxy=Math.max(maxy,vertice[1]);minx=tminx<minx?tminx:minx;miny=tminy<miny?tminy:miny;maxx=tmaxx>maxx?tmaxx:maxx;maxy=tmaxy>maxy?tmaxy:maxy;}
if(this.angle)
this.bounds=[Math.abs(Math.cos(this.angle)*(maxx-minx)),Math.abs(Math.sin(this.angle)*(maxy-miny))];else
this.bounds=[maxx-minx,maxy-miny];};wamt.Polygon.prototype.setColliding=function(colliding)
{this.collideable=colliding;this.scene.updated=true;};wamt.Polygon.prototype.setHollow=function(hollow)
{this.hollow=hollow;this.scene.updated=true;};wamt.Polygon.prototype.tick=function(scene,layer,view)
{if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}}
this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Polygon.prototype.render=function(view)
{var radians=this.radians;view.context.fillStyle=this.style;view.context.strokeStyle=this.style;view.context.shadowOffsetX=this.shadow[0];view.context.shadowOffsetY=this.shadow[1];view.context.shadowBlur=this.shadow[2];view.context.shadowColor=this.shadow[3];if(radians==0)
{view.context.beginPath();for(var i=0;i<this.vertices.length;i++)
{var vertice=this.vertices[i];view.context.lineTo(this.screenX+vertice[0],this.screenY+vertice[1]);}
if(this.hollow)
view.context.stroke();else
view.context.fill();}
else
{var transx=(this.width/2)+this.screenX;var transy=(this.height/2)+this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);view.context.beginPath();for(var i=0;i<this.vertices.length;i++)
{var vertice=this.vertices[i];view.context.lineTo(this.screenX+vertice[0],this.screenY+vertice[1]);}
if(this.hollow)
view.context.stroke();else
view.context.fill();view.context.restore();}
view.context.fillStyle="";view.context.strokeStyle="";view.context.shadowOffsetX="";view.context.shadowOffsetY="";view.context.shadowBlur="";view.context.shadowColor="";this.processEvent("render",{object:this,view:view});};wamt.Polygon.prototype.setStyle=function(style)
{this.style=style;this.scene.updated=true;};wamt.Polygon.prototype.setShadow=function(offsetx,offsety,blur,color)
{this.shadow=[offsetx,offsety,blur,color];this.scene.updated=true;};wamt.Polygon.prototype.setShadowCasting=function(shadowcast)
{this.shadowcast=shadowcast;this.scene.updated=true;};wamt.Polygon.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Polygon.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Polygon.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Polygon.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Polygon.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Polygon.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Polygon.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Polygon.prototype.stop=function()
{this.velocity=[0,0];this.scene.updated=true;};wamt.Polygon.prototype.setVertices=function(vertices)
{this.vertices=vertices;this.computeBounds();this.scene.updated=true;};wamt.Polygon.prototype.stretchX=function(x)
{for(var i=0;i<this.vertices.length;i++)
{vertice=this.vertices[i];vertice[0]+=x;}
this.computeBounds();this.scene.updated=true;}
wamt.Polygon.prototype.stretchY=function(y)
{for(var i=0;i<this.vertices.length;i++)
{vertice=this.vertices[i];vertice[1]+=y;}
this.computeBounds();this.scene.updated=true;}
wamt.Polygon.prototype.stretch=function(x,y)
{for(var i=0;i<this.vertices.length;i++)
{vertice=this.vertices[i];vertice[0]+=x;vertice[1]+=y;}
this.computeBounds();this.scene.updated=true;}
wamt.Polygon.prototype.setAngle=function(angle)
{this.angle=angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Polygon.prototype.rotate=function(angle)
{this.angle+=angle;if(this.angle>360)
this.angle=this.angle-360;else if(this.angle<0)
this.angle=360-this.angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Polygon.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Polygon.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Polygon.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};wamt.Sprite=function(image,x,y,angle)
{this.events=[];this.collideable=true;this.image=image;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.tileWidth=0;this.tileHeight=0;this.tileAnimation="";this.tileAnimationFrame=0;this.tileAnimationSpeed=0;this.tileAnimations=[];this.screenX=this.x;this.screenY=this.y;this.angle=typeof(angle)=="undefined"?0:angle;this.radians=typeof(angle)=="undefined"?0:Math.radians(angle);this.width=image.width;this.height=image.height;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.shadowcast=false;this.computeBounds();};wamt.Sprite.prototype.constructor=wamt.Sprite;wamt.Sprite.prototype.computeBounds=function()
{if(this.angle==0||this.angle==180)
this.bounds=[this.width,this.height];else if(this.angle==90||this.angle==270)
this.bounds=[this.height,this.width];else
this.bounds=[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)];};wamt.Sprite.prototype.setColliding=function(colliding)
{this.collideable=colliding;};wamt.Sprite.prototype.tick=function(scene,layer,view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.pretick(this);if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}}
if(typeof(this.behaviour)!="undefined")
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Sprite.prototype.render=function(view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.prerender(this);var radians=this.radians;view.context.shadowOffsetX=this.shadow[0];view.context.shadowOffsetY=this.shadow[1];view.context.shadowBlur=this.shadow[2];view.context.shadowColor=this.shadow[3];var animation=this.tileAnimations[this.tileAnimation];if(typeof(animation)=="undefined")
{if(radians==0)
view.context.drawImage(this.image,this.screenX,this.screenY,this.width,this.height);else
{var transx=(this.width/2)+this.screenX;var transy=(this.height/2)+this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);view.context.drawImage(this.image,this.screenX,this.screenY,this.width,this.height);view.context.restore();}}
else
{var fa=this.tileAnimationSpeed/wamt.delta;var of=Math.floor(this.tileAnimationFrame);this.tileAnimationFrame+=fa;if(this.tileAnimationFrame>animation[2]*animation[3]+1)
this.tileAnimationFrame=0;var ff=Math.floor(this.tileAnimationFrame);if(ff!=of)
this.processEvent("frame");var tilex=Math.floor(ff%animation[2]);var tiley=Math.floor(ff%animation[3]);if(radians==0)
view.context.drawImage(this.image,animation[0]*this.tileWidth+tilex*this.tileWidth,animation[1]*this.tileHeight+tiley*this.tileHeight,this.tileWidth,this.tileHeight,this.screenX,this.screenY,this.width,this.height);else
{var transx=(this.width/2)+this.screenX;var transy=(this.height/2)+this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);view.context.drawImage(this.image,animation[0]*this.tileWidth+tilex*this.tileWidth,animation[1]*this.tileHeight+tiley*this.tileHeight,this.tileWidth,this.tileHeight,this.screenX,this.screenY,this.width,this.height);view.context.restore();}}
view.context.shadowOffsetX="";view.context.shadowOffsetY="";view.context.shadowBlur="";view.context.shadowColor="";if(typeof(this.behaviour)!="undefined")
this.behaviour.render(this);this.processEvent("render",{object:this,view:view});};wamt.Sprite.prototype.setShadow=function(offsetx,offsety,blur,color)
{this.shadow=[offsetx,offsety,blur,color];this.scene.updated=true;};wamt.Sprite.prototype.setShadowCasting=function(shadowcast)
{this.shadowcast=shadowcast;this.scene.updated=true;};wamt.Sprite.prototype.setImage=function(image)
{this.clearTileAnimations();this.image=image;this.width=image.width;this.height=image.height;this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.setTiling=function(width,height)
{this.width=width;this.height=height;this.computeBounds();this.tileWidth=width;this.tileHeight=height;this.scene.updated=true;};wamt.Sprite.prototype.clearTileAnimations=function()
{this.tileAnimation="";this.tileAnimationFrame=0;this.tileAnimationSpeed=0;this.tileAnimations=[];};wamt.Sprite.prototype.addTileAnimation=function(name,x,y,framesx,framesy)
{this.tileAnimations[name]=[x,y,framesx,framesy];};wamt.Sprite.prototype.playTileAnimation=function(name,speed)
{var animation=this.tileAnimations[name];if(typeof(animation)=="undefined")
return;speed=typeof(speed)=="number"?speed:1;if(animation[0]==animation[2]&&animation[1]==animation[3])
speed=0;if(name!=this.tileAnimation)
this.tileAnimationFrame=0;this.tileAnimation=name;this.tileAnimationSpeed=speed;this.scene.updated=true;};wamt.Sprite.prototype.setTileAnimationSpeed=function(speed)
{if(animation[0]==animation[2]&&animation[1]==animation[3])
speed=0;this.tileAnimationSpeed=speed;this.scene.updated=1;};wamt.Sprite.prototype.pauseTileAnimation=function()
{this.tileAnimationSpeed=0;};wamt.Sprite.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Sprite.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Sprite.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Sprite.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Sprite.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Sprite.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Sprite.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Sprite.prototype.stop=function()
{this.velocity=[0,0];this.scene.updated=true;};wamt.Sprite.prototype.setWidth=function(width)
{this.width=width;this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.setHeight=function(height)
{this.height=height;this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.setSize=function(width,height)
{this.width=width;this.height=height;this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.stretchX=function(width)
{this.width+=width;if(this.width<1)
this.width=1;this.computeBounds();this.scene.updated=true;}
wamt.Sprite.prototype.stretchY=function(height)
{this.height+=height;if(this.height<1)
this.height=1;this.computeBounds();this.scene.updated=true;}
wamt.Sprite.prototype.stretch=function(width,height)
{this.width+=width;if(this.width<1)
this.width=1;this.height+=height;if(this.height<1)
this.height=1;this.computeBounds();this.scene.updated=true;}
wamt.Sprite.prototype.setAngle=function(angle)
{this.angle=angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.rotate=function(angle)
{this.angle+=angle;if(this.angle>360)
this.angle=this.angle-360;else if(this.angle<0)
this.angle=360-this.angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Sprite.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Sprite.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Sprite.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};wamt.Text=function(text,font,style,x,y,angle)
{this.events=[];this.collideable=false;this.x=typeof(x)=="undefined"?0:x;this.y=typeof(y)=="undefined"?0:y;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof(angle)=="undefined"?0:angle;this.radians=typeof(angle)=="undefined"?0:Math.radians(angle);this.width=1;this.height=10;this.text=text;this.font=font;this.style=style;this.align="start";this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.hollow=false;this.updated=true;this.computeBounds();};wamt.Text.prototype.constructor=wamt.Text;wamt.Text.prototype.computeBounds=function()
{if(this.angle==0||this.angle==180)
this.bounds=[this.width,this.height];else if(this.angle==90||this.angle==270)
this.bounds=[this.height,this.width];else
this.bounds=[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)];};wamt.Text.prototype.setColliding=function(colliding)
{this.collideable=colliding;};wamt.Text.prototype.setHollow=function(hollow)
{this.hollow=hollow;this.scene.updated=true;};wamt.Text.prototype.tick=function(scene,layer,view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.pretick(this);if(this.velocity[0]!=0||this.velocity[1]!=0)
this.translate(this.velocity[0],this.velocity[1]);if(scene.updated)
{if(this.updated)
{this.width=view.context.measureText(this.text).width;var fspos=this.font.indexOf("px");if(fspos!=-1)
{var fs=this.font.substring(0,fspos);this.height=parseInt(fs);}
else
this.height=10;this.updated=false;}
if(layer.locked)
{this.screenX=this.x;this.screenY=this.y;}
else
{this.screenX=-view.x+this.x+(view.canvas.width/2);this.screenY=-view.y+this.y+(view.canvas.height/2);}}
if(typeof(this.behaviour)!="undefined")
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:scene,layer:layer,view:view});};wamt.Text.prototype.render=function(view)
{if(typeof(this.behaviour)!="undefined")
this.behaviour.prerender(this);var radians=this.radians;view.context.strokeStyle=this.style;view.context.fillStyle=this.style;view.context.font=this.font;view.context.textAlign=this.align;view.context.shadowOffsetX=this.shadow[0];view.context.shadowOffsetY=this.shadow[1];view.context.shadowBlur=this.shadow[2];view.context.shadowColor=this.shadow[3];if(radians==0)
{if(this.hollow)
view.context.strokeText(this.text,this.screenX,this.screenY);else
view.context.fillText(this.text,this.screenX,this.screenY);}
else
{var transx=(this.width/2)+this.screenX;var transy=(this.height/2)+this.screenY;view.context.save();view.context.translate(transx,transy);view.context.rotate(radians);view.context.translate(-transx,-transy);if(this.hollow)
view.context.strokeText(this.text,this.screenX,this.screenY);else
view.context.fillText(this.text,this.screenX,this.screenY);view.context.restore();}
view.context.strokeStyle="";view.context.fillStyle="";view.context.font="";view.context.shadowOffsetX="";view.context.shadowOffsetY="";view.context.shadowBlur="";view.context.shadowColor="";if(typeof(this.behaviour)!="undefined")
this.behaviour.render(this);this.processEvent("render",{object:this,view:view});};wamt.Text.prototype.setStyle=function(style)
{this.style=style;this.updated=true;this.scene.updated=true;};wamt.Text.prototype.setFont=function(font)
{this.font=font;this.updated=true;this.scene.updated=true;};wamt.Text.prototype.setText=function(text)
{this.text=text;this.updated=true;this.scene.updated=true;};wamt.Text.prototype.setShadow=function(offsetx,offsety,blur,color)
{this.shadow=[offsetx,offsety,blur,color];this.scene.updated=true;};wamt.Text.prototype.setShadowCasting=function(shadowcast)
{this.shadowcast=shadowcast;this.scene.updated=true;};wamt.Text.prototype.setX=function(x)
{this.x=x;this.scene.updated=true;};wamt.Text.prototype.setY=function(y)
{this.y=y;this.scene.updated=true;};wamt.Text.prototype.setPosition=function(x,y)
{this.x=x;this.y=y;this.scene.updated=true;};wamt.Text.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Text.prototype.translateX=function(x)
{this.x+=x;this.scene.updated=true;};wamt.Text.prototype.translateY=function(y)
{this.y+=y;this.scene.updated=true;};wamt.Text.prototype.translate=function(x,y)
{this.x+=x;this.y+=y;this.scene.updated=true;};wamt.Text.prototype.setVelocity=function(x,y)
{this.velocity=[x,y];this.scene.updated=true;};wamt.Text.prototype.stop=function()
{this.velocity=[0,0];this.scene.updated=true;};wamt.Text.prototype.setAngle=function(angle)
{this.angle=angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Text.prototype.rotate=function(angle)
{this.angle+=angle;if(this.angle>360)
this.angle=this.angle-360;else if(this.angle<0)
this.angle=360-this.angle;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=true;};wamt.Text.prototype.setBehaviour=function(behaviour)
{this.behaviour=behaviour;this.scene.updated=true;};wamt.Text.prototype.addEventListener=function(type,bind)
{var e=this.events[type];if(typeof(e)=="undefined")
this.events[type]=[];this.events[type].push(bind);};wamt.Text.prototype.processEvent=function(type,holder)
{var e=this.events[type];if(typeof(e)!="undefined")
{for(var i=0;i<e.length;i++)
{e[i](holder);}}};