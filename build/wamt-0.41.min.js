var wamt={time:new Date,delta:0,fps:0,behaviours:{}};wamt.support={canvas:typeof window.CanvasRenderingContext2D!="undefined",light:typeof window.CanvasRenderingContext2D.prototype.createRadialGradient!="undefined"&&typeof window.CanvasRenderingContext2D.prototype.setShadow!="undefined"};wamt.settings={culling:!0,smoothing:!0};Math.radians=function(a){return a*Math.PI/180};Math.degrees=function(a){return a*180/Math.PI};
window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();wamt.play=function(a){a.worker=setInterval(function(){a.logic()},16.6666667)};wamt.pause=function(a){clearInterval(a.worker)};
wamt.process=function(a,b){var c=new Date;wamt.delta=c-wamt.time;wamt.fps=Math.round(1E3/wamt.delta);wamt.time=c;if(a.updated||b.updated){b.clearCanvas();b.renderBackdrop();if(typeof b.target!="undefined")b.x=b.target.x,b.y=b.target.y;for(var c=b.canvas.width,d=b.canvas.height,f=0;f<a.layers.length;f++){var g=a.layers[f];b.context.globalCompositeOperation=g.composite;b.context.globalAlpha=g.opacity;for(var e=0;e<g.objects.length;e++){var h=g.objects[e];h.tick(a,g,b);if(typeof h.render!="undefined"){var i=
h.screenX+h.bounds[0],j=h.screenY+h.bounds[1],k=c+h.bounds[0]*2,l=d+h.bounds[1]*2;(i>=-k&&i<=k&&j>=-l&&j<=l&&h.visible||!wamt.settings.culling)&&h.render(b)}}g.processEvent("tick",{scene:a,view:b});g.processEvent("render",{scene:a,view:b})}a.processEvent("tick",{scene:a,view:b});a.processEvent("render",{scene:a,view:b});a.updated=!1;b.updated=!1}else{for(f=0;f<a.layers.length;f++){g=a.layers[f];for(e=0;e<g.objects.length;e++)g.objects[e].tick(a,g,b);g.processEvent("tick",{scene:a,view:b})}a.processEvent("tick",
{scene:a,view:b})}};wamt.Layer=function(a,b){this.events=[];this.scene=a;this.index=b;this.objects=[];this.opacity=1;this.composite="source-over";this.locked=!1};wamt.Layer.prototype.constructor=wamt.Layer;wamt.Layer.prototype.addObject=function(a){a.scene=this.scene;a.layer=this;this.objects.push(a)};wamt.Layer.prototype.removeObject=function(a){this.objects.splice(this.objects.indexOf(a),1);this.scene.updated=!0};wamt.Layer.prototype.setOpacity=function(a){this.opacity=a;this.scene.updated=!0};
wamt.Layer.prototype.clear=function(){this.objects=[];this.scene.updated=!0};wamt.Layer.prototype.setCompositeOperation=function(a){this.composite=a;this.scene.updated=!0};wamt.Layer.prototype.setLocked=function(a){this.locked=a;this.scene.updated=!0};wamt.Layer.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Layer.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.Scene=function(){this.events=[];this.updated=!1;this.time=new Date;this.layers=[]};wamt.Scene.prototype.constructor=wamt.Scene;wamt.Scene.prototype.getLayer=function(a){for(var b,c=0;c<this.layers.length;c++){var d=this.layers[c];if(d.index==a){b=d;break}}return b};wamt.Scene.prototype.createLayer=function(a){a=new wamt.Layer(this,a);this.layers.push(a);this.layers.sort(function(a,c){if(a.index<c.index)return-1;return a.index>c.index?1:0});return a};
wamt.Scene.prototype.addObject=function(a,b){b=typeof b=="number"?b:0;c=this.getLayer(b);if(typeof c=="undefined")var c=this.createLayer(b);c.addObject(a);if(typeof a.render!="undefined")this.updated=!0};wamt.Scene.prototype.removeObject=function(a){this.getLayer(a.layer.index).removeObject(a)};wamt.Scene.prototype.clear=function(){this.layers=[];this.updated=!0};
wamt.Scene.prototype.logic=function(){for(var a=0;a<this.layers.length;a++)for(var b=this.layers[a],c=0;c<b.objects.length;c++)b.objects[c].logic(this);this.processEvent("logic",{scene:this})};wamt.Scene.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Scene.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.View=function(a,b,c){this.events=[];this.canvas=a;this.context=a.getContext("2d");this.x=typeof b=="undefined"?a.width/2:b;this.y=typeof c=="undefined"?a.height/2:c};wamt.View.prototype.constructor=wamt.View;
wamt.View.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b);switch(a){case "mousemove":this.canvas.addEventListener("mousemove",function(a){a.view=this;a.context=this.view;b(a)},!1);break;case "mousedown":this.canvas.addEventListener("mousedown",function(a){a.view=this;a.context=this.view;b(a)},!1);break;case "mouseup":this.canvas.addEventListener("mouseup",function(a){a.view=this;a.context=this.view;b(a)},!1);break;case "click":this.canvas.addEventListener("click",
function(a){a.view=this;a.context=this.view;b(a)},!1)}};wamt.View.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};wamt.View.prototype.setBackdrop=function(a){this.backdrop=a};
wamt.View.prototype.renderBackdrop=function(){if(typeof this.backdrop!="undefined")this.backdrop instanceof Image?this.context.drawImage(this.backdrop,0,0,this.canvas.width,this.canvas.height):(this.context.fillStyle=this.backdrop,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="")};wamt.View.prototype.setCanvas=function(a){this.canvas=a;this.context=a.getContext("2d")};wamt.View.prototype.clearCanvas=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};
wamt.View.prototype.setTarget=function(a){this.target=a};wamt.View.prototype.setX=function(a){this.x=a;this.updated=!0};wamt.View.prototype.setY=function(a){this.y=a;this.updated=!0};wamt.View.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.updated=!0};wamt.View.prototype.translateX=function(a){this.x+=a;this.updated=!0};wamt.View.prototype.translateY=function(a){this.y+=a;this.updated=!0};wamt.View.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.updated=!0};
wamt.Box=function(a,b,c,d,f,g){this.events=[];this.collideable=!0;this.x=typeof d=="undefined"?0:d;this.y=typeof f=="undefined"?0:f;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof g=="undefined"?0:g;this.radians=typeof g=="undefined"?0:Math.radians(g);this.width=b;this.height=c;this.style=a;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.hollow=!1;this.visible=!0;this.computeBounds()};wamt.Box.prototype.constructor=wamt.Box;
wamt.Box.prototype.computeBounds=function(){this.bounds=this.angle==0||this.angle==180?[this.width,this.height]:this.angle==90||this.angle==270?[this.height,this.width]:[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)]};wamt.Box.prototype.setColliding=function(a){this.collideable=a};wamt.Box.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};wamt.Box.prototype.setHollow=function(a){this.hollow=a;this.scene.updated=!0};
wamt.Box.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Box.prototype.tick=function(a,b,c){typeof this.behaviour!="undefined"&&this.behaviour.pretick(this);if(a.updated)b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2);typeof this.behaviour!="undefined"&&this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Box.prototype.render=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prerender(this);var b=this.radians;a.context.strokeStyle=this.style;a.context.fillStyle=this.style;a.context.shadowOffsetX=this.shadow[0];a.context.shadowOffsetY=this.shadow[1];a.context.shadowBlur=this.shadow[2];a.context.shadowColor=this.shadow[3];if(b==0)this.hollow?a.context.strokeRect(this.screenX,this.screenY,this.width,this.height):a.context.fillRect(this.screenX,this.screenY,this.width,this.height);else{var c=
this.width/2+this.screenX,d=this.height/2+this.screenY;a.context.save();a.context.translate(c,d);a.context.rotate(b);a.context.translate(-c,-d);this.hollow?a.context.strokeRect(this.screenX,this.screenY,this.width,this.height):a.context.fillRect(this.screenX,this.screenY,this.width,this.height);a.context.restore()}a.context.strokeStyle="";a.context.fillStyle="";a.context.shadowOffsetX="";a.context.shadowOffsetY="";a.context.shadowBlur="";a.context.shadowColor="";typeof this.behaviour!="undefined"&&
this.behaviour.render(this);this.processEvent("render",{object:this,view:a})};wamt.Box.prototype.setStyle=function(a){this.style=a;this.scene.updated=!0};wamt.Box.prototype.setShadow=function(a,b,c,d){this.shadow=[a,b,c,d];this.scene.updated=!0};wamt.Box.prototype.setShadowCasting=function(a){this.shadowcast=a;this.scene.updated=!0};wamt.Box.prototype.setX=function(a){this.x=a;this.scene.updated=!0};wamt.Box.prototype.setY=function(a){this.y=a;this.scene.updated=!0};
wamt.Box.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};wamt.Box.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Box.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Box.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};wamt.Box.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};wamt.Box.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};
wamt.Box.prototype.stop=function(){this.velocity=[0,0];this.scene.updated=!0};wamt.Box.prototype.setWidth=function(a){this.width=a;this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.setHeight=function(a){this.height=a;this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.setSize=function(a,b){this.width=a;this.height=b;this.computeBounds();this.scene.updated=!0};
wamt.Box.prototype.stretchX=function(a){this.width+=a;if(this.width<1)this.width=1;this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.stretchY=function(a){this.height+=a;if(this.height<1)this.height=1;this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.stretch=function(a,b){this.width+=a;if(this.width<1)this.width=1;this.height+=b;if(this.height<1)this.height=1;this.computeBounds();this.scene.updated=!0};
wamt.Box.prototype.setAngle=function(a){this.angle=a%360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.rotate=function(a){this.angle+=a;this.angle%=360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Box.prototype.setBehaviour=function(a){this.behaviour=a;a.init(this);this.scene.updated=!0};wamt.Box.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};
wamt.Box.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};wamt.Box.prototype.destroy=function(){this.scene.removeObject(this)};
wamt.Circle=function(a,b,c,d,f){this.events=[];this.collideable=!0;this.x=typeof c=="undefined"?0:c;this.y=typeof d=="undefined"?0:d;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof f=="undefined"?0:f;this.radians=typeof f=="undefined"?0:Math.radians(f);this.radius=b;this.style=a;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.hollow=this.shadowcast=!1;this.visible=!0;this.computeBounds()};wamt.Circle.prototype.constructor=wamt.Circle;
wamt.Circle.prototype.computeBounds=function(){this.bounds=[this.radius*2,this.radius*2]};wamt.Circle.prototype.setColliding=function(a){this.collideable=a};wamt.Circle.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};wamt.Circle.prototype.setHollow=function(a){this.hollow=a;this.scene.updated=!0};
wamt.Circle.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Circle.prototype.tick=function(a,b,c){typeof this.behaviour!="undefined"&&this.behaviour.pretick(this);if(a.updated)b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2);typeof this.behaviour!="undefined"&&this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Circle.prototype.render=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prerender(this);var b=this.radians;a.context.fillStyle=this.style;a.context.strokeStyle=this.style;a.context.shadowOffsetX=this.shadow[0];a.context.shadowOffsetY=this.shadow[1];a.context.shadowBlur=this.shadow[2];a.context.shadowColor=this.shadow[3];if(b==0)a.context.beginPath(),a.context.arc(this.screenX,this.screenY,this.radius,0,Math.PI*2,!1),this.hollow?a.context.stroke():a.context.fill();else{var c=this.screenX,
d=this.screenY;a.context.save();a.context.translate(c,d);a.context.rotate(b);a.context.translate(-c,-d);a.context.beginPath();a.context.arc(this.screenX,this.screenY,this.radius,0,Math.PI*2,!1);this.hollow?a.context.stroke():a.context.fill();a.context.restore()}a.context.shadowOffsetX="";a.context.shadowOffsetY="";a.context.shadowBlur="";a.context.shadowColor="";a.context.fillStyle="";a.context.strokeStyle="";typeof this.behaviour!="undefined"&&this.behaviour.render(this);this.processEvent("render",
{object:this,view:a})};wamt.Circle.prototype.setStyle=function(a){this.style=a;this.scene.updated=!0};wamt.Circle.prototype.setShadow=function(a,b,c,d){this.shadow=[a,b,c,d];this.scene.updated=!0};wamt.Circle.prototype.setShadowCasting=function(a){this.shadowcast=a;this.scene.updated=!0};wamt.Circle.prototype.setX=function(a){this.x=a;this.scene.updated=!0};wamt.Circle.prototype.setY=function(a){this.y=a;this.scene.updated=!0};
wamt.Circle.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};wamt.Circle.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Circle.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Circle.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};wamt.Circle.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};
wamt.Circle.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};wamt.Circle.prototype.setRadius=function(a){this.radius=a;this.computeBounds();this.scene.updated=!0};wamt.Circle.prototype.stretch=function(a){this.radius+=a;if(this.radius<1)this.radius=1;this.computeBounds();this.scene.updated=!0};wamt.Circle.prototype.setAngle=function(a){this.angle=a%360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};
wamt.Circle.prototype.rotate=function(a){this.angle+=a;this.angle%=360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Circle.prototype.setBehaviour=function(a){this.behaviour=a;a.init(this);this.scene.updated=!0};wamt.Circle.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Circle.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.Circle.prototype.destroy=function(){this.scene.removeObject(this)};wamt.collision={};
wamt.collision.screenPointTest=function(a,b,c,d){var f=[];if(a instanceof wamt.Layer)for(var g=0;g<a.objects.length;g++){var e=a.objects[g];e.collideable&&e!=d&&(e instanceof wamt.Text?e.screenX<=b&&e.screenX+e.bounds[0]>=b&&e.screenY>=c&&e.screenY-e.bounds[1]<=c&&f.push(e):e.screenX<=b&&e.screenX+e.bounds[0]>=b&&e.screenY<=c&&e.screenY+e.bounds[1]>=c&&f.push(e))}else for(var h=0;h<a.layers.length;h++)for(var i=a.layers[h],g=0;g<i.objects.length;g++)e=i.objects[g],e.collideable&&e!=d&&e.screenX<=
b&&e.screenX+e.bounds[0]>=b&&e.screenY<=c&&e.screenY+e.bounds[1]>=c&&f.push(e);return f};
wamt.collision.boxSearch=function(a,b,c,d,f,g){var e=[];if(a instanceof wamt.Layer)for(var h=0;h<a.objects.length;h++){var i=a.objects[h];i.collideable&&i!=g&&(i.x>b+d||i.x+i.bounds[0]<b||i.y>c+f||i.y+i.bounds[1]<c||e.push(i))}else for(var j=0;j<a.layers.length;j++)for(var k=a.layers[j],h=0;h<k.objects.length;h++)i=k.objects[h],i.collideable&&i!=g&&(i.x>b+d||i.x+i.bounds[0]<b||i.y>c+f||i.y+i.bounds[1]<c||e.push(i));return e};
wamt.collision.pointTest=function(a,b,c,d){var f=[];if(a instanceof wamt.Layer)for(var g=0;g<a.objects.length;g++){var e=a.objects[g];e.collideable&&e!=d&&(e instanceof wamt.Text?e.x<=b&&e.x+e.bounds[0]>=b&&e.y>=c&&e.y-e.bounds[1]<=c&&f.push(e):e.x<=b&&e.x+e.bounds[0]>=b&&e.y<=c&&e.y+e.bounds[1]>=c&&f.push(e))}else for(var h=0;h<a.layers.length;h++)for(var i=a.layers[h],g=0;g<i.objects.length;g++)e=i.objects[g],e.collideable&&e!=d&&(e instanceof wamt.Text?e.x<=b&&e.x+e.bounds[0]>=b&&e.y>=c&&e.y-e.bounds[1]<=
c&&f.push(e):e.x<=b&&e.x+e.bounds[0]>=b&&e.y<=c&&e.y+e.bounds[1]>=c&&f.push(e));return f};
wamt.collision.intersectTest=function(a,b){var c=[];if(a instanceof wamt.Layer)for(var d=0;d<a.objects.length;d++){var f=a.objects[d];f.collideable&&f!=b&&(f.x>b.x+b.bounds[0]||f.x+f.bounds[0]<b.x||f.y>b.y+b.bounds[1]||f.y+f.bounds[1]<b.y||c.push(f))}else for(var g=0;g<a.layers.length;g++)for(var e=a.layers[g],d=0;d<e.objects.length;d++)f=e.objects[d],f.collideable&&f!=b&&(f.x>b.x+b.bounds[0]||f.x+f.bounds[0]<b.x||f.y>b.y+b.bounds[1]||f.y+f.bounds[1]<b.y||c.push(f));return c};
wamt.Light=function(a,b,c,d){this.events=[];this.collideable=!1;this.x=typeof c=="undefined"?0:c;this.y=typeof d=="undefined"?0:d;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.intensity=b;this.color=a;this.visible=!0;this.computeBounds()};wamt.Light.prototype.constructor=wamt.Light;wamt.Light.prototype.computeBounds=function(){this.bounds=[this.intensity*2,this.intensity*2]};wamt.Light.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};
wamt.Light.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Light.prototype.tick=function(a,b,c){typeof this.behaviour!="undefined"&&this.behaviour.pretick(this);if(a.updated){b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2);for(var d=0;d<b.objects.length;d++){var f=b.objects[d];if(f.shadowcast){var g=f.x-this.x,e=f.y-this.y;if(Math.abs(g)>this.intensity*1.5||Math.abs(e)>this.intensity*1.5)f.setShadow(0,0,0,"rgba(0,0,0,0");else{var h=0.3/this.intensity;f.setShadow(g*
h*f.bounds[0],e*h*f.bounds[1],this.intensity*h,"rgba(0,0,0,0.35)")}}}}typeof this.behaviour!="undefined"&&this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Light.prototype.render=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prerender(this);var b=a.context.createRadialGradient(this.screenX,this.screenY,0,this.screenX,this.screenY,this.intensity);b.addColorStop(0,this.color);b.addColorStop(1,"rgba(0,0,0,0)");a.context.fillStyle=b;a.context.beginPath();a.context.arc(this.screenX,this.screenY,this.intensity,0,Math.PI*2,!1);a.context.fill();a.context.fillStyle="";typeof this.behaviour!="undefined"&&this.behaviour.render(this);this.processEvent("render",
{object:this,view:a})};wamt.Light.prototype.setColor=function(a,b,c,d){this.color=[a,b,c,d];this.scene.updated=!0};wamt.Light.prototype.setIntensity=function(a){this.intensity=a;this.computeBounds();this.scene.updated=!0};wamt.Light.prototype.intensify=function(a){this.intensity+=a;if(this.intensity<1)this.intensity=1;this.computeBounds();this.scene.updated=!0};wamt.Light.prototype.setX=function(a){this.x=a;this.scene.updated=!0};wamt.Light.prototype.setY=function(a){this.y=a;this.scene.updated=!0};
wamt.Light.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};wamt.Light.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Light.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Light.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};wamt.Light.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};wamt.Light.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};
wamt.Light.prototype.setBehaviour=function(a){this.behaviour=a;a.init(this);this.scene.updated=!0};wamt.Light.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Light.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};wamt.Light.prototype.destroy=function(){this.scene.removeObject(this)};
wamt.Polygon=function(a,b,c,d,f){this.events=[];this.collideable=!0;this.x=typeof c=="undefined"?0:c;this.y=typeof d=="undefined"?0:d;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof f=="undefined"?0:f;this.radians=typeof f=="undefined"?0:Math.radians(f);this.vertices=b;this.style=a;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.shadowcast=!1;this.visible=!0;this.computeBounds()};wamt.Polygon.prototype.constructor=wamt.Polygon;
wamt.Polygon.prototype.computeBounds=function(){for(var a=0,b=0,c=0,d=0,f=0;f<this.vertices.length;f++)var g=this.vertices[f],e=Math.min(a,g[0]),h=Math.min(b,g[0]),i=Math.max(c,g[1]),g=Math.max(d,g[1]),a=e<a?e:a,b=h<b?h:b,c=i>c?i:c,d=g>d?g:d;this.bounds=this.angle?[Math.abs(Math.cos(this.angle)*(c-a)),Math.abs(Math.sin(this.angle)*(d-b))]:[c-a,d-b]};wamt.Polygon.prototype.setColliding=function(a){this.collideable=a;this.scene.updated=!0};
wamt.Polygon.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};wamt.Polygon.prototype.setHollow=function(a){this.hollow=a;this.scene.updated=!0};
wamt.Polygon.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Polygon.prototype.tick=function(a,b,c){if(a.updated)b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Polygon.prototype.render=function(a){var b=this.radians;a.context.fillStyle=this.style;a.context.strokeStyle=this.style;a.context.shadowOffsetX=this.shadow[0];a.context.shadowOffsetY=this.shadow[1];a.context.shadowBlur=this.shadow[2];a.context.shadowColor=this.shadow[3];if(b==0){a.context.beginPath();for(b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.context.lineTo(this.screenX+c[0],this.screenY+c[1])}this.hollow?a.context.stroke():a.context.fill()}else{var c=this.width/2+this.screenX,
d=this.height/2+this.screenY;a.context.save();a.context.translate(c,d);a.context.rotate(b);a.context.translate(-c,-d);a.context.beginPath();for(b=0;b<this.vertices.length;b++)c=this.vertices[b],a.context.lineTo(this.screenX+c[0],this.screenY+c[1]);this.hollow?a.context.stroke():a.context.fill();a.context.restore()}a.context.fillStyle="";a.context.strokeStyle="";a.context.shadowOffsetX="";a.context.shadowOffsetY="";a.context.shadowBlur="";a.context.shadowColor="";this.processEvent("render",{object:this,
view:a})};wamt.Polygon.prototype.setStyle=function(a){this.style=a;this.scene.updated=!0};wamt.Polygon.prototype.setShadow=function(a,b,c,d){this.shadow=[a,b,c,d];this.scene.updated=!0};wamt.Polygon.prototype.setShadowCasting=function(a){this.shadowcast=a;this.scene.updated=!0};wamt.Polygon.prototype.setX=function(a){this.x=a;this.scene.updated=!0};wamt.Polygon.prototype.setY=function(a){this.y=a;this.scene.updated=!0};
wamt.Polygon.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};wamt.Polygon.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Polygon.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Polygon.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};wamt.Polygon.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};
wamt.Polygon.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};wamt.Polygon.prototype.stop=function(){this.velocity=[0,0];this.scene.updated=!0};wamt.Polygon.prototype.setVertices=function(a){this.vertices=a;this.computeBounds();this.scene.updated=!0};wamt.Polygon.prototype.stretchX=function(a){for(var b=0;b<this.vertices.length;b++)vertice=this.vertices[b],vertice[0]+=a;this.computeBounds();this.scene.updated=!0};
wamt.Polygon.prototype.stretchY=function(a){for(var b=0;b<this.vertices.length;b++)vertice=this.vertices[b],vertice[1]+=a;this.computeBounds();this.scene.updated=!0};wamt.Polygon.prototype.stretch=function(a,b){for(var c=0;c<this.vertices.length;c++)vertice=this.vertices[c],vertice[0]+=a,vertice[1]+=b;this.computeBounds();this.scene.updated=!0};wamt.Polygon.prototype.setAngle=function(a){this.angle=a%360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};
wamt.Polygon.prototype.rotate=function(a){this.angle+=a;this.angle%=360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Polygon.prototype.setBehaviour=function(a){this.behaviour=a;a.init(this);this.scene.updated=!0};wamt.Polygon.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Polygon.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.Polygon.prototype.destroy=function(){this.scene.removeObject(this)};
wamt.Sprite=function(a,b,c,d){this.events=[];this.collideable=!0;this.image=a;this.x=typeof b=="undefined"?0:b;this.y=typeof c=="undefined"?0:c;this.velocity=[0,0];this.tileHeight=this.tileWidth=0;this.tileAnimation="";this.tileAnimationSpeed=this.tileAnimationFrame=0;this.tileAnimations=[];this.screenX=this.x;this.screenY=this.y;this.angle=typeof d=="undefined"?0:d;this.radians=typeof d=="undefined"?0:Math.radians(d);this.width=a.width;this.height=a.height;this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.shadowcast=
!1;this.visible=!0;this.computeBounds()};wamt.Sprite.prototype.constructor=wamt.Sprite;wamt.Sprite.prototype.computeBounds=function(){this.bounds=this.angle==0||this.angle==180?[this.width,this.height]:this.angle==90||this.angle==270?[this.height,this.width]:[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)]};wamt.Sprite.prototype.setColliding=function(a){this.collideable=a};wamt.Sprite.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};
wamt.Sprite.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Sprite.prototype.tick=function(a,b,c){typeof this.behaviour!="undefined"&&this.behaviour.pretick(this);if(a.updated)b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2);typeof this.behaviour!="undefined"&&this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Sprite.prototype.render=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prerender(this);var b=this.radians;a.context.shadowOffsetX=this.shadow[0];a.context.shadowOffsetY=this.shadow[1];a.context.shadowBlur=this.shadow[2];a.context.shadowColor=this.shadow[3];var c=this.tileAnimations[this.tileAnimation];if(typeof c=="undefined")if(b==0)a.context.drawImage(this.image,this.screenX,this.screenY,this.width,this.height);else{var d=this.width/2+this.screenX,f=this.height/2+this.screenY;
a.context.save();a.context.translate(d,f);a.context.rotate(b);a.context.translate(-d,-f);a.context.drawImage(this.image,this.screenX,this.screenY,this.width,this.height);a.context.restore()}else{var g=Math.floor(this.tileAnimationFrame);this.tileAnimationFrame+=this.tileAnimationSpeed/wamt.delta;if(this.tileAnimationFrame>c[2]*c[3]+1)this.tileAnimationFrame=0;d=Math.floor(this.tileAnimationFrame);d!=g&&this.processEvent("frame");var g=Math.floor(d%c[2]),e=Math.floor(d%c[3]);b==0?a.context.drawImage(this.image,
c[0]*this.tileWidth+g*this.tileWidth,c[1]*this.tileHeight+e*this.tileHeight,this.tileWidth,this.tileHeight,this.screenX,this.screenY,this.width,this.height):(d=this.width/2+this.screenX,f=this.height/2+this.screenY,a.context.save(),a.context.translate(d,f),a.context.rotate(b),a.context.translate(-d,-f),a.context.drawImage(this.image,c[0]*this.tileWidth+g*this.tileWidth,c[1]*this.tileHeight+e*this.tileHeight,this.tileWidth,this.tileHeight,this.screenX,this.screenY,this.width,this.height),a.context.restore())}a.context.shadowOffsetX=
"";a.context.shadowOffsetY="";a.context.shadowBlur="";a.context.shadowColor="";typeof this.behaviour!="undefined"&&this.behaviour.render(this);this.processEvent("render",{object:this,view:a})};wamt.Sprite.prototype.setShadow=function(a,b,c,d){this.shadow=[a,b,c,d];this.scene.updated=!0};wamt.Sprite.prototype.setShadowCasting=function(a){this.shadowcast=a;this.scene.updated=!0};
wamt.Sprite.prototype.setImage=function(a){this.clearTileAnimations();this.image=a;this.width=a.width;this.height=a.height;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.setTiling=function(a,b){this.width=a;this.height=b;this.computeBounds();this.tileWidth=a;this.tileHeight=b;this.scene.updated=!0};wamt.Sprite.prototype.clearTileAnimations=function(){this.tileAnimation="";this.tileAnimationSpeed=this.tileAnimationFrame=0;this.tileAnimations=[]};
wamt.Sprite.prototype.addTileAnimation=function(a,b,c,d,f){this.tileAnimations[a]=[b,c,d,f]};wamt.Sprite.prototype.playTileAnimation=function(a,b){var c=this.tileAnimations[a];if(typeof c!="undefined"){b=typeof b=="number"?b:1;c[0]==c[2]&&c[1]==c[3]&&(b=0);if(a!=this.tileAnimation)this.tileAnimationFrame=0;this.tileAnimation=a;this.tileAnimationSpeed=b;this.scene.updated=!0}};
wamt.Sprite.prototype.setTileAnimationSpeed=function(a){animation[0]==animation[2]&&animation[1]==animation[3]&&(a=0);this.tileAnimationSpeed=a;this.scene.updated=1};wamt.Sprite.prototype.pauseTileAnimation=function(){this.tileAnimationSpeed=0};wamt.Sprite.prototype.setX=function(a){this.x=a;this.scene.updated=!0};wamt.Sprite.prototype.setY=function(a){this.y=a;this.scene.updated=!0};wamt.Sprite.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};
wamt.Sprite.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Sprite.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Sprite.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};wamt.Sprite.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};wamt.Sprite.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};wamt.Sprite.prototype.stop=function(){this.velocity=[0,0];this.scene.updated=!0};
wamt.Sprite.prototype.setWidth=function(a){this.width=a;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.setHeight=function(a){this.height=a;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.setSize=function(a,b){this.width=a;this.height=b;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.stretchX=function(a){this.width+=a;if(this.width<1)this.width=1;this.computeBounds();this.scene.updated=!0};
wamt.Sprite.prototype.stretchY=function(a){this.height+=a;if(this.height<1)this.height=1;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.stretch=function(a,b){this.width+=a;if(this.width<1)this.width=1;this.height+=b;if(this.height<1)this.height=1;this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.setAngle=function(a){this.angle=a%360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};
wamt.Sprite.prototype.rotate=function(a){this.angle+=a;this.angle%=360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Sprite.prototype.setBehaviour=function(a){this.behaviour=a;a.init(this);this.scene.updated=!0};wamt.Sprite.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Sprite.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.Sprite.prototype.destroy=function(){this.scene.removeObject(this)};
wamt.Text=function(a,b,c,d,f,g){this.events=[];this.collideable=!1;this.x=typeof d=="undefined"?0:d;this.y=typeof f=="undefined"?0:f;this.velocity=[0,0];this.screenX=this.x;this.screenY=this.y;this.angle=typeof g=="undefined"?0:g;this.radians=typeof g=="undefined"?0:Math.radians(g);this.width=1;this.height=10;this.text=String(a).split("\n");this.font=b;this.style=c;this.align="start";this.shadow=[0,0,0,"rgba(0,0,0,0)"];this.hollow=!1;this.updated=this.visible=!0;this.computeBounds()};
wamt.Text.prototype.constructor=wamt.Text;wamt.Text.prototype.computeBounds=function(){this.bounds=this.angle==0||this.angle==180?[this.width,this.height]:this.angle==90||this.angle==270?[this.height,this.width]:[Math.abs(Math.cos(this.angle)*this.width),Math.abs(Math.sin(this.angle)*this.height)]};wamt.Text.prototype.setColliding=function(a){this.collideable=a};wamt.Text.prototype.setVisible=function(a){this.visible=a;this.scene.updated=!0};
wamt.Text.prototype.setHollow=function(a){this.hollow=a;this.scene.updated=!0};wamt.Text.prototype.logic=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prelogic(this);if(this.velocity[0]!=0||this.velocity[1]!=0)typeof this.behaviour!="undefined"?this.behaviour.velocity(this):this.translate(this.velocity[0],this.velocity[1]);typeof this.behaviour!="undefined"&&this.behaviour.logic(this);this.processEvent("logic",{object:this,scene:a})};
wamt.Text.prototype.tick=function(a,b,c){typeof this.behaviour!="undefined"&&this.behaviour.pretick(this);if(a.updated){if(this.updated){this.width=c.context.measureText(this.text).width;var d=this.font.indexOf("px");d!=-1?(d=this.font.substring(0,d),this.height=parseInt(d)):this.height=10;this.computeBounds();this.updated=!1}b.locked?(this.screenX=this.x,this.screenY=this.y):(this.screenX=-c.x+this.x+c.canvas.width/2,this.screenY=-c.y+this.y+c.canvas.height/2)}typeof this.behaviour!="undefined"&&
this.behaviour.tick(this);this.processEvent("tick",{object:this,scene:a,layer:b,view:c})};
wamt.Text.prototype.render=function(a){typeof this.behaviour!="undefined"&&this.behaviour.prerender(this);var b=this.radians;a.context.strokeStyle=this.style;a.context.fillStyle=this.style;a.context.font=this.font;a.context.textAlign=this.align;a.context.shadowOffsetX=this.shadow[0];a.context.shadowOffsetY=this.shadow[1];a.context.shadowBlur=this.shadow[2];a.context.shadowColor=this.shadow[3];if(b==0)if(this.hollow)for(b=0;b<this.text.length;b++){var c=this.text[b];a.context.strokeText(c,this.screenX,
this.screenY+b*this.height*1.5)}else for(b=0;b<this.text.length;b++)c=this.text[b],a.context.fillText(c,this.screenX,this.screenY+b*this.height*1.5);else{var c=this.width/2+this.screenX,d=this.height/2+this.screenY;a.context.save();a.context.translate(c,d);a.context.rotate(b);a.context.translate(-c,-d);if(this.hollow)for(b=0;b<this.text.length;b++)c=this.text[b],a.context.strokeText(c,this.screenX,this.screenY+b*this.height*1.5);else for(b=0;b<this.text.length;b++)c=this.text[b],a.context.fillText(c,
this.screenX,this.screenY+b*this.height*1.5);a.context.restore()}a.context.strokeStyle="";a.context.fillStyle="";a.context.font="";a.context.shadowOffsetX="";a.context.shadowOffsetY="";a.context.shadowBlur="";a.context.shadowColor="";typeof this.behaviour!="undefined"&&this.behaviour.render(this);this.processEvent("render",{object:this,view:a})};wamt.Text.prototype.setStyle=function(a){this.style=a;this.updated=!0;this.scene.updated=!0};
wamt.Text.prototype.setFont=function(a){this.font=a;this.updated=!0;this.scene.updated=!0};wamt.Text.prototype.setText=function(a){this.text=String(a).split("\n");this.updated=!0;this.scene.updated=!0};wamt.Text.prototype.setShadow=function(a,b,c,d){this.shadow=[a,b,c,d];this.scene.updated=!0};wamt.Text.prototype.setShadowCasting=function(a){this.shadowcast=a;this.scene.updated=!0};wamt.Text.prototype.setX=function(a){this.x=a;this.scene.updated=!0};
wamt.Text.prototype.setY=function(a){this.y=a;this.scene.updated=!0};wamt.Text.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.scene.updated=!0};wamt.Text.prototype.snap=function(a,b){this.translate(-(this.x%a),-(this.y%b))};wamt.Text.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};wamt.Text.prototype.translateX=function(a){this.x+=a;this.scene.updated=!0};wamt.Text.prototype.translateY=function(a){this.y+=a;this.scene.updated=!0};
wamt.Text.prototype.translate=function(a,b){this.x+=a;this.y+=b;this.scene.updated=!0};wamt.Text.prototype.setVelocity=function(a,b){this.velocity=[a,b];this.scene.updated=!0};wamt.Text.prototype.stop=function(){this.velocity=[0,0];this.scene.updated=!0};wamt.Text.prototype.setAngle=function(a){this.angle=a%360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};
wamt.Text.prototype.rotate=function(a){this.angle+=a;this.angle%=360;this.radians=Math.radians(this.angle);this.computeBounds();this.scene.updated=!0};wamt.Text.prototype.setBehaviour=function(a){this.behaviour=a;this.scene.updated=!0};wamt.Text.prototype.addEventListener=function(a,b){typeof this.events[a]=="undefined"&&(this.events[a]=[]);this.events[a].push(b)};wamt.Text.prototype.processEvent=function(a,b){var c=this.events[a];if(typeof c!="undefined")for(var d=0;d<c.length;d++)c[d](b)};
wamt.Text.prototype.destroy=function(){this.scene.removeObject(this)};
